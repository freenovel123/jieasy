import{f as ue,Y as re,g as x,m as L,A as te,l as ne,r as i,o as V,c as N,a as e,w as l,b as $,d as c,M as C,N as R,Z as se,$ as de,E as q,H as T,D as _e,a0 as ge,a1 as ae,a2 as be,J as ye,_ as ie,a3 as Ve,V as p,t as oe,a4 as Fe}from"./index-DtxwDEIz.js";import{S as Se}from"./index-Vgg-Up5C.js";import{S as k}from"./index-CqmSVsX1.js";const Ue={class:"steve-category-tools"},ke={class:"structure"},xe={class:"structure-body"},we={class:"structure-body__url"},Ee={class:"structure-body__url__type"},Te={key:1,class:"structure-body__param"},Ce={key:2,class:"structure-body__param"},he={key:3,class:"structure-body__group"},$e={class:"group-body__name"},Ne={class:"group-body__ace"},ze={class:"group-body__option"},Oe=ue({__name:"index",props:{visible:{type:Boolean,default:!1},value:Object},emits:["update:visible","confirm"],setup(H,{emit:I}){const u=H,{visible:z,value:P}=re(u),D=I,E=x(!1);L(z,n=>{E.value=n}),L(E,n=>{D("update:visible",n)});const r=x(te({uuid:"",name:"",method:"GET",params:"",pageMax:30,mode:"http",requestEncode:"utf-8",responseEncode:"utf-8",structure:"",list:[]}));L(P,n=>{n?(r.value=n,v.value=n.list):(r.value.uuid="",r.value.name="",r.value.structure="",r.value.list=[],v.value=[])});const m=x([]);L(r,n=>{const{structure:t}=n;if(t){m.value=[];const d=/@{_(.*?)}/g;for(const F of t.matchAll(d)){const[,U]=F;U&&!m.value.includes(U)&&m.value.push(U)}const f=[];for(const F of m.value){const U=W(F);U?f.push(U):f.push({name:F,type:F,list:""})}v.value=f}},{deep:!0});const a=x(1);L(a,()=>{O()});const _=x(""),S=x(0),g=x(0),j=ne(()=>g.value>0&&S.value!==g.value),h=x(0),v=x([]),b=()=>{const n=v.value[h.value];if(n){const t=ge(n.list);if(t&&t.length>0){for(const d of t){let f=r.value.structure;!T.isURL(d.path)&&T.isURL(f)&&(f=ae(f)),T.isURL(d.path)&&!T.isURL(f)&&(d.path=ae(d.path));const U=be(f).exec(d.path);d.value=U?U[h.value+1]:"",delete d.path}v.value[h.value].list=ye(JSON.stringify(t))}else q("请输入有效的HTML内容！","warning")}},y=n=>{const{selectedText:t,selectionStart:d,selectionEnd:f}=Q(n.target);_.value=t,S.value=d,g.value=f},A=()=>{_.value&&(r.value.structure=`${r.value.structure.slice(0,S.value)}@{_${_.value}}${r.value.structure.slice(g.value)}`,q(`构造${_.value}成功！`),O())},K=n=>{r.value.structure=`${r.value.structure.slice(0,S.value)}@{${n}}${r.value.structure.slice(g.value)}`,O()},O=()=>{_.value="",S.value=0,g.value=0},o=()=>{const n=r.value;if(!n.name){q("请输入榜单名称","warning");return}if(!n.structure){q("请输入构造地址","warning");return}n.uuid||(n.uuid=`${new Date().getTime()}`);const t=te(v.value);if(t&&t.length>0){for(const d of t)d&&T.isJSON(d.list)&&(d.list=_e(d.list));n.list=t}D("confirm",n)};function W(n){let t;for(const d of v.value)d.type===n&&(t=d);return t}function Q(n){let t="";const{selectionStart:d,selectionEnd:f}=n;return d!==f?t=n.value.substring(d,f):t="",{selectedText:t,selectionStart:d,selectionEnd:f}}return(n,t)=>{const d=i("t-input"),f=i("t-form-item"),F=i("t-col"),U=i("t-input-number"),B=i("t-row"),w=i("t-radio-button"),J=i("t-radio-group"),ee=i("t-textarea"),me=i("t-divider"),X=i("t-tag"),M=i("t-button"),G=i("t-space"),pe=i("t-tab-panel"),ce=i("t-tabs"),ve=i("t-form"),fe=i("t-drawer");return V(),N("div",Ue,[e(fe,{visible:E.value,"onUpdate:visible":t[12]||(t[12]=s=>E.value=s),header:"榜单设置",size:"50%","close-on-overlay-click":!1,"destroy-on-close":!0,onCancel:t[13]||(t[13]=s=>E.value=!1),onConfirm:o},{default:l(()=>[$("div",ke,[$("div",xe,[e(ve,null,{default:l(()=>[e(G,{size:10,direction:"vertical"},{default:l(()=>[e(B,{class:"row-gap"},{default:l(()=>[e(F,{span:6},{default:l(()=>[e(f,{label:"榜单名称",name:"formData.name"},{default:l(()=>[e(d,{modelValue:r.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.name=s),placeholder:"榜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:l(()=>[e(f,{label:"最大翻页数",name:"version"},{default:l(()=>[e(U,{modelValue:r.value.pageMax,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.pageMax=s),min:"1",max:"300",theme:"column","allow-input-over-limit":!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(B,{class:"row-gap"},{default:l(()=>[e(F,{span:6},{default:l(()=>[e(f,{label:"请求方式",name:"formData.method"},{default:l(()=>[e(J,{modelValue:r.value.method,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.method=s),size:"small",variant:"default-filled"},{default:l(()=>[e(w,{value:"GET"},{default:l(()=>[c("GET")]),_:1}),e(w,{value:"POST"},{default:l(()=>[c("POST")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:l(()=>[e(f,{label:"请求模式",name:"formData.method"},{default:l(()=>[e(J,{modelValue:r.value.mode,"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.mode=s),size:"small",variant:"default-filled"},{default:l(()=>[e(w,{value:"http"},{default:l(()=>[c("HTTP")]),_:1}),e(w,{value:"webview"},{default:l(()=>[c("WebView")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(B,{class:"row-gap"},{default:l(()=>[e(F,{span:6},{default:l(()=>[e(f,{label:n.$t("pages.source.common.requestEncode"),name:"ruleSearch.requestEncode"},{default:l(()=>[e(J,{modelValue:r.value.requestEncode,"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.requestEncode=s),size:"small",variant:"default-filled"},{default:l(()=>[e(w,{value:"utf-8"},{default:l(()=>[c("UTF-8")]),_:1}),e(w,{value:"gbk"},{default:l(()=>[c("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(F,{span:6},{default:l(()=>[e(f,{label:n.$t("pages.source.common.responseEncode"),name:"ruleSearch.responseEncode"},{default:l(()=>[e(J,{modelValue:r.value.responseEncode,"onUpdate:modelValue":t[5]||(t[5]=s=>r.value.responseEncode=s),size:"small",variant:"default-filled"},{default:l(()=>[e(w,{value:"utf-8"},{default:l(()=>[c("UTF-8")]),_:1}),e(w,{value:"gbk"},{default:l(()=>[c("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),r.value.method==="POST"?(V(),C(B,{key:0,class:"row-gap"},{default:l(()=>[e(F,{span:12},{default:l(()=>[e(f,{label:"请求参数",name:"formData.params"},{default:l(()=>[e(ee,{modelValue:r.value.params,"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.params=s),placeholder:"请求参数应该为一个json类型的字符串"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):R("",!0),e(me,{align:"left"},{default:l(()=>[c("构造地址")]),_:1}),$("div",we,[$("div",Ee,[e(J,{modelValue:a.value,"onUpdate:modelValue":t[7]||(t[7]=s=>a.value=s),size:"small",variant:"default-filled"},{default:l(()=>[e(w,{value:1},{default:l(()=>[c("构造分组")]),_:1}),e(w,{value:2},{default:l(()=>[c("快捷操作")]),_:1})]),_:1},8,["modelValue"])]),e(ee,{modelValue:r.value.structure,"onUpdate:modelValue":t[8]||(t[8]=s=>r.value.structure=s),placeholder:"请输入榜单页面完整的URL地址或路径(即不包含host的path)，使用鼠标选中或直接根据规则修改即可构造相应的分组以及参数",autosize:{minRows:3,maxRows:5},onMouseup:y},null,8,["modelValue"])]),a.value==1?(V(),N("div",Te,[j.value?(V(),C(G,{key:0,align:"center",size:"2px"},{default:l(()=>[e(X,{theme:"primary",variant:"light"},{default:l(()=>[c("@{_")]),_:1}),e(d,{modelValue:_.value,"onUpdate:modelValue":t[9]||(t[9]=s=>_.value=s),placeholder:"请输入自定义参数名称",class:"structure-body__param__input",size:"small"},null,8,["modelValue"]),e(X,{theme:"primary",variant:"light"},{default:l(()=>[c("}")]),_:1}),e(M,{class:"button",size:"small",onClick:A},{default:l(()=>[c("确认")]),_:1}),e(M,{class:"button",theme:"default",size:"small",onClick:O},{default:l(()=>[c("取消")]),_:1})]),_:1})):(V(),C(X,{key:1,variant:"light",theme:"primary"},{default:l(()=>[c("请先选中需要构造的内容")]),_:1}))])):R("",!0),a.value==2?(V(),N("div",Ce,[e(G,{size:"10px"},{default:l(()=>[e(M,{size:"small",onClick:t[10]||(t[10]=s=>K("pageIndex"))},{default:l(()=>[c("添加页码")]),_:1})]),_:1})])):R("",!0),v.value.length>0?(V(),N("div",he,[e(ce,{modelValue:h.value,"onUpdate:modelValue":t[11]||(t[11]=s=>h.value=s),theme:"card"},{default:l(()=>[(V(!0),N(se,null,de(v.value,(s,le)=>(V(),C(pe,{key:le,value:le,label:s.name,"destroy-on-hide":!1},{default:l(()=>[e(G,{class:"group-body",direction:"vertical",size:10},{default:l(()=>[$("div",$e,[e(d,{modelValue:s.name,"onUpdate:modelValue":Y=>s.name=Y,placeholder:"分组名称，比如，分类、排序、状态等"},null,8,["modelValue","onUpdate:modelValue"])]),$("div",Ne,[e(Se,{value:s.list,"onUpdate:value":Y=>s.list=Y,height:300},null,8,["value","onUpdate:value"])]),$("div",ze,[e(M,{onClick:b},{default:l(()=>[c("转换")]),_:1})])]),_:2},1024)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])):R("",!0)]),_:1})]),_:1})])])]),_:1},8,["visible"])])}}}),De=ie(Oe,[["__scopeId","data-v-8f56941f"]]),Je={class:"finder"},Le=ue({__name:"finder",props:{formData:Object},setup(H){const I=H,{formData:u}=re(I),z=x(!1),P=x({}),D=m=>{P.value=m,z.value=!0},E=ne(()=>{const{category:m}=u.value.ruleFinder;return T.isJSON(m)?JSON.parse(m):[]}),Z=m=>{const{category:a}=u.value.ruleFinder;let _=[];a&&T.isJSON(a)&&(_=JSON.parse(a));let S=!1;for(let g=0;g<_.length;g++)_[g].uuid===m.uuid&&(_[g]=m,S=!0);S||_.push(m),u.value.ruleFinder.category=JSON.stringify(_),z.value=!1},r=m=>{if(m.type==="delete"){const{category:a}=u.value.ruleFinder,_=[];if(a&&T.isJSON(a)){const S=JSON.parse(a);for(const g of S)g.uuid!==m.value&&_.push(g);u.value.ruleFinder.category=JSON.stringify(_)}}};return(m,a)=>{const _=i("t-textarea"),S=i("t-button"),g=i("t-dropdown"),j=i("t-space"),h=i("t-tag"),v=i("t-form-item"),b=i("t-col"),y=i("t-row"),A=i("t-radio-button"),K=i("t-radio-group"),O=i("t-divider");return V(),N("div",Je,[e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:"榜单",name:"ruleFinder.category"},{tips:l(()=>[e(S,{size:"small",class:"finder-tools",onClick:a[1]||(a[1]=o=>D(null))},{default:l(()=>[c("添加榜单")]),_:1})]),default:l(()=>[Ve(e(_,{modelValue:p(u).ruleFinder.category,"onUpdate:modelValue":a[0]||(a[0]=o=>p(u).ruleFinder.category=o)},null,8,["modelValue"]),[[Fe,!1]]),E.value.length>0?(V(),C(j,{key:0,size:10},{default:l(()=>[(V(!0),N(se,null,de(E.value,(o,W)=>(V(),C(g,{key:W,options:[{content:"删除",type:"delete",value:o.uuid}],onClick:r},{default:l(()=>[o&&o.name?(V(),C(S,{key:0,variant:"outline",theme:"primary",onClick:Q=>D(o)},{default:l(()=>[c(oe(o.name),1)]),_:2},1032,["onClick"])):R("",!0)]),_:2},1032,["options"]))),128))]),_:1})):(V(),C(h,{key:1,theme:"primary",variant:"light-outline"},{default:l(()=>[c("暂时还没有榜单，添加一个吧！")]),_:1}))]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.engine"),name:"ruleFinder.engine"},{default:l(()=>[e(K,{modelValue:p(u).ruleFinder.engine,"onUpdate:modelValue":a[2]||(a[2]=o=>p(u).ruleFinder.engine=o),size:"small",variant:"default-filled"},{default:l(()=>[e(A,{value:"xpath"},{default:l(()=>[c("XPATH")]),_:1}),e(A,{value:"jsonpath"},{default:l(()=>[c("JSONPATH")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:"书籍列表",name:"ruleFinder.bookList"},{default:l(()=>[e(k,{value:p(u).ruleFinder.bookList,"onUpdate:value":a[3]||(a[3]=o=>p(u).ruleFinder.bookList=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:"书籍名称",name:"ruleFinder.bookName"},{default:l(()=>[e(k,{value:p(u).ruleFinder.bookName,"onUpdate:value":a[4]||(a[4]=o=>p(u).ruleFinder.bookName=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:"书籍地址",name:"ruleFinder.bookUrl"},{default:l(()=>[e(k,{value:p(u).ruleFinder.bookUrl,"onUpdate:value":a[5]||(a[5]=o=>p(u).ruleFinder.bookUrl=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:"书籍作者",name:"ruleFinder.bookAuthor"},{default:l(()=>[e(k,{value:p(u).ruleFinder.bookAuthor,"onUpdate:value":a[6]||(a[6]=o=>p(u).ruleFinder.bookAuthor=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(O,{align:"right"},{default:l(()=>[c(oe(m.$t("pages.source.common.extendedRule")),1)]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookDescription"),name:"ruleFinder.ruleExtra.introduce"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.introduce,"onUpdate:value":a[7]||(a[7]=o=>p(u).ruleFinder.ruleExtra.introduce=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookCover"),name:"ruleFinder.ruleExtra.coverUrl"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.coverUrl,"onUpdate:value":a[8]||(a[8]=o=>p(u).ruleFinder.ruleExtra.coverUrl=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookCategory"),name:"ruleFinder.ruleExtra.classify"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.classify,"onUpdate:value":a[9]||(a[9]=o=>p(u).ruleFinder.ruleExtra.classify=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookSize"),name:"ruleFinder.ruleExtra.bookSize"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.bookSize,"onUpdate:value":a[10]||(a[10]=o=>p(u).ruleFinder.ruleExtra.bookSize=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookLatestChapterName"),name:"ruleFinder.ruleExtra.lastChapterName"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.lastChapterName,"onUpdate:value":a[11]||(a[11]=o=>p(u).ruleFinder.ruleExtra.lastChapterName=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookLatestUpdateTime"),name:"ruleFinder.ruleExtra.lastUpdateTime"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.lastUpdateTime,"onUpdate:value":a[12]||(a[12]=o=>p(u).ruleFinder.ruleExtra.lastUpdateTime=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(b,{span:12},{default:l(()=>[e(v,{label:m.$t("pages.source.common.bookCompletionStatus"),name:"ruleFinder.ruleExtra.status"},{default:l(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.status,"onUpdate:value":a[13]||(a[13]=o=>p(u).ruleFinder.ruleExtra.status=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(De,{visible:z.value,"onUpdate:visible":a[14]||(a[14]=o=>z.value=o),value:P.value,onConfirm:Z},null,8,["visible","value"])])}}}),Be=ie(Le,[["__scopeId","data-v-a3d5bd8c"]]);export{Be as default};
