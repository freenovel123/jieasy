import{f as ae,V as oe,g as S,m as O,A as ee,l as ue,r as c,o as F,c as C,a as e,w as l,b as z,d as _,M as w,N as D,W as re,X as se,E as B,H as x,D as fe,Y as _e,Z as le,$ as ve,J as ge,_ as ne,a0 as be,R as p,t as te,a1 as Ve}from"./index-CgOOQVTy.js";import ye from"./AceEditor-CaFwyuu2.js";const Fe={class:"steve-category-tools"},Ue={class:"structure"},ke={class:"structure-body"},Se={class:"structure-body__url"},Ee={class:"structure-body__url__type"},xe={key:1,class:"structure-body__param"},we={key:2,class:"structure-body__param"},Te={key:3,class:"structure-body__group"},ze={class:"group-body__name"},Ce={class:"group-body__ace"},he={class:"group-body__option"},$e=ae({__name:"index",props:{visible:{type:Boolean,default:!1},value:Object},emits:["update:visible","confirm"],setup(G,{emit:q}){const u=G,{visible:h,value:J}=oe(u),N=q,E=S(!1);O(h,r=>{E.value=r}),O(E,r=>{N("update:visible",r)});const n=S(ee({uuid:"",name:"",method:"GET",params:"",requestEncode:"utf-8",responseEncode:"utf-8",structure:"",list:[]}));O(J,r=>{r?(n.value=r,f.value=r.list):(n.value.uuid="",n.value.name="",n.value.structure="",n.value.list=[],f.value=[])});const m=S([]);O(n,r=>{const{structure:t}=r;if(t){m.value=[];const d=/@{_(.*?)}/g;for(const k of t.matchAll(d)){const[,g]=k;g&&!m.value.includes(g)&&m.value.push(g)}const v=[];for(const k of m.value){const g=M(k);g?v.push(g):v.push({name:k,type:k,list:""})}f.value=v}},{deep:!0});const a=S(1);O(a,()=>{$()});const s=S(""),U=S(0),b=S(0),H=ue(()=>b.value>0&&U.value!==b.value),T=S(0),f=S([]),V=()=>{const r=f.value[T.value];if(r){const t=_e(r.list);if(t&&t.length>0){for(const d of t){let v=n.value.structure;!x.isURL(d.path)&&x.isURL(v)&&(v=le(v)),x.isURL(d.path)&&!x.isURL(v)&&(d.path=le(d.path));const g=ve(v).exec(d.path);d.value=g?g[T.value+1]:"",delete d.path}f.value[T.value].list=ge(JSON.stringify(t))}else B("请输入有效的HTML内容！","warning")}},y=r=>{const{selectedText:t,selectionStart:d,selectionEnd:v}=Y(r.target);s.value=t,U.value=d,b.value=v},L=()=>{s.value&&(n.value.structure=`${n.value.structure.slice(0,U.value)}@{_${s.value}}${n.value.structure.slice(b.value)}`,B(`构造${s.value}成功！`),$())},I=r=>{n.value.structure=`${n.value.structure.slice(0,U.value)}@{params.${r}}${n.value.structure.slice(b.value)}`,$()},$=()=>{s.value="",U.value=0,b.value=0},o=()=>{const r=n.value;if(!r.name){B("请输入榜单名称","warning");return}if(!r.structure){B("请输入构造地址","warning");return}r.uuid||(r.uuid=`${new Date().getTime()}`);const t=ee(f.value);if(t&&t.length>0){for(const d of t)d&&x.isJSON(d.list)&&(d.list=fe(d.list));r.list=t}N("confirm",r)};function M(r){let t;for(const d of f.value)d.type===r&&(t=d);return t}function Y(r){let t="";const{selectionStart:d,selectionEnd:v}=r;return d!==v?t=r.value.substring(d,v):t="",{selectedText:t,selectionStart:d,selectionEnd:v}}return(r,t)=>{const d=c("t-input"),v=c("t-form-item"),k=c("t-col"),g=c("t-radio-button"),R=c("t-radio-group"),j=c("t-row"),Z=c("t-textarea"),de=c("t-divider"),K=c("t-tag"),A=c("t-button"),P=c("t-space"),ie=c("t-tab-panel"),me=c("t-tabs"),pe=c("t-form"),ce=c("t-drawer");return F(),C("div",Fe,[e(ce,{visible:E.value,"onUpdate:visible":t[10]||(t[10]=i=>E.value=i),header:"榜单设置",size:"50%","close-on-overlay-click":!1,"destroy-on-close":!0,onCancel:t[11]||(t[11]=i=>E.value=!1),onConfirm:o},{default:l(()=>[z("div",Ue,[z("div",ke,[e(pe,null,{default:l(()=>[e(P,{size:10,direction:"vertical"},{default:l(()=>[e(j,{class:"row-gap"},{default:l(()=>[e(k,{span:6},{default:l(()=>[e(v,{label:"榜单名称",name:"formData.name"},{default:l(()=>[e(d,{modelValue:n.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>n.value.name=i),placeholder:"榜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{span:6},{default:l(()=>[e(v,{label:"请求方式",name:"formData.method"},{default:l(()=>[e(R,{modelValue:n.value.method,"onUpdate:modelValue":t[1]||(t[1]=i=>n.value.method=i),size:"small",variant:"default-filled"},{default:l(()=>[e(g,{value:"GET"},{default:l(()=>[_("GET")]),_:1}),e(g,{value:"POST"},{default:l(()=>[_("POST")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{class:"row-gap"},{default:l(()=>[e(k,{span:6},{default:l(()=>[e(v,{label:r.$t("pages.source.common.requestEncode"),name:"ruleSearch.requestEncode"},{default:l(()=>[e(R,{modelValue:n.value.requestEncode,"onUpdate:modelValue":t[2]||(t[2]=i=>n.value.requestEncode=i),size:"small",variant:"default-filled"},{default:l(()=>[e(g,{value:"utf-8"},{default:l(()=>[_("UTF-8")]),_:1}),e(g,{value:"gbk"},{default:l(()=>[_("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(k,{span:6},{default:l(()=>[e(v,{label:r.$t("pages.source.common.responseEncode"),name:"ruleSearch.responseEncode"},{default:l(()=>[e(R,{modelValue:n.value.responseEncode,"onUpdate:modelValue":t[3]||(t[3]=i=>n.value.responseEncode=i),size:"small",variant:"default-filled"},{default:l(()=>[e(g,{value:"utf-8"},{default:l(()=>[_("UTF-8")]),_:1}),e(g,{value:"gbk"},{default:l(()=>[_("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),n.value.method==="POST"?(F(),w(j,{key:0,class:"row-gap"},{default:l(()=>[e(k,{span:12},{default:l(()=>[e(v,{label:"请求参数",name:"formData.params"},{default:l(()=>[e(Z,{modelValue:n.value.params,"onUpdate:modelValue":t[4]||(t[4]=i=>n.value.params=i),placeholder:"请求参数应该为一个json类型的字符串"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):D("",!0),e(de,{align:"left"},{default:l(()=>[_("构造地址")]),_:1}),z("div",Se,[z("div",Ee,[e(R,{modelValue:a.value,"onUpdate:modelValue":t[5]||(t[5]=i=>a.value=i),size:"small",variant:"default-filled"},{default:l(()=>[e(g,{value:1},{default:l(()=>[_("构造分组")]),_:1}),e(g,{value:2},{default:l(()=>[_("快捷操作")]),_:1})]),_:1},8,["modelValue"])]),e(Z,{modelValue:n.value.structure,"onUpdate:modelValue":t[6]||(t[6]=i=>n.value.structure=i),placeholder:"请输入榜单页面完整的URL地址或路径(即不包含host的path)，使用鼠标选中或直接根据规则修改即可构造相应的分组以及参数",autosize:{minRows:3,maxRows:5},onMouseup:y},null,8,["modelValue"])]),a.value==1?(F(),C("div",xe,[H.value?(F(),w(P,{key:0,align:"center",size:"2px"},{default:l(()=>[e(K,{theme:"primary",variant:"light"},{default:l(()=>[_("@{_")]),_:1}),e(d,{modelValue:s.value,"onUpdate:modelValue":t[7]||(t[7]=i=>s.value=i),placeholder:"请输入自定义参数名称",class:"structure-body__param__input",size:"small"},null,8,["modelValue"]),e(K,{theme:"primary",variant:"light"},{default:l(()=>[_("}")]),_:1}),e(A,{class:"button",onClick:L,size:"small"},{default:l(()=>[_("确认")]),_:1}),e(A,{class:"button",theme:"default",onClick:$,size:"small"},{default:l(()=>[_("取消")]),_:1})]),_:1})):(F(),w(K,{key:1,variant:"light",theme:"primary"},{default:l(()=>[_("请先选中需要构造的内容")]),_:1}))])):D("",!0),a.value==2?(F(),C("div",we,[e(P,{size:"10px"},{default:l(()=>[e(A,{size:"small",onClick:t[8]||(t[8]=i=>I("pageIndex"))},{default:l(()=>[_("添加页码")]),_:1})]),_:1})])):D("",!0),f.value.length>0?(F(),C("div",Te,[e(me,{modelValue:T.value,"onUpdate:modelValue":t[9]||(t[9]=i=>T.value=i),theme:"card"},{default:l(()=>[(F(!0),C(re,null,se(f.value,(i,Q)=>(F(),w(ie,{key:Q,value:Q,label:i.name,"destroy-on-hide":!1},{default:l(()=>[e(P,{class:"group-body",direction:"vertical",size:10},{default:l(()=>[z("div",ze,[e(d,{modelValue:i.name,"onUpdate:modelValue":X=>i.name=X,placeholder:"分组名称，比如，分类、排序、状态等"},null,8,["modelValue","onUpdate:modelValue"])]),z("div",Ce,[e(ye,{value:i.list,"onUpdate:value":X=>i.list=X,height:300,placeholder:"请输入需要转换的HTML代码"},null,8,["value","onUpdate:value"])]),z("div",he,[e(A,{onClick:V},{default:l(()=>[_("转换")]),_:1})])]),_:2},1024)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])):D("",!0)]),_:1})]),_:1})])])]),_:1},8,["visible"])])}}}),Ne=ne($e,[["__scopeId","data-v-f696968e"]]),Oe={class:"finder"},De=ae({__name:"finder",props:{formData:Object},setup(G){const q=G,{formData:u}=oe(q),h=S(!1),J=S({}),N=m=>{J.value=m,h.value=!0},E=ue(()=>{const{category:m}=u.value.ruleFinder;return x.isJSON(m)?JSON.parse(m):[]}),W=m=>{const{category:a}=u.value.ruleFinder;let s=[];a&&x.isJSON(a)&&(s=JSON.parse(a));let U=!1;for(let b=0;b<s.length;b++)s[b].uuid===m.uuid&&(s[b]=m,U=!0);U||s.push(m),u.value.ruleFinder.category=JSON.stringify(s),h.value=!1},n=m=>{if(m.type==="delete"){const{category:a}=u.value.ruleFinder,s=[];if(a&&x.isJSON(a)){const U=JSON.parse(a);for(const b of U)b.uuid!==m.value&&s.push(b);u.value.ruleFinder.category=JSON.stringify(s)}}};return(m,a)=>{const s=c("t-textarea"),U=c("t-button"),b=c("t-dropdown"),H=c("t-space"),T=c("t-tag"),f=c("t-form-item"),V=c("t-col"),y=c("t-row"),L=c("t-radio-button"),I=c("t-radio-group"),$=c("t-divider");return F(),C("div",Oe,[e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:"榜单",name:"ruleFinder.category"},{tips:l(()=>[e(U,{size:"small",class:"finder-tools",onClick:a[1]||(a[1]=o=>N(null))},{default:l(()=>[_("添加榜单")]),_:1})]),default:l(()=>[be(e(s,{modelValue:p(u).ruleFinder.category,"onUpdate:modelValue":a[0]||(a[0]=o=>p(u).ruleFinder.category=o)},null,8,["modelValue"]),[[Ve,!1]]),E.value.length>0?(F(),w(H,{key:0,size:10},{default:l(()=>[(F(!0),C(re,null,se(E.value,(o,M)=>(F(),w(b,{key:M,options:[{content:"删除",type:"delete",value:o.uuid}],onClick:n},{default:l(()=>[o&&o.name?(F(),w(U,{key:0,variant:"outline",theme:"primary",onClick:Y=>N(o)},{default:l(()=>[_(te(o.name),1)]),_:2},1032,["onClick"])):D("",!0)]),_:2},1032,["options"]))),128))]),_:1})):(F(),w(T,{key:1,theme:"primary",variant:"light-outline"},{default:l(()=>[_("暂时还没有榜单，添加一个吧！")]),_:1}))]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.engine"),name:"ruleFinder.engine"},{default:l(()=>[e(I,{modelValue:p(u).ruleFinder.engine,"onUpdate:modelValue":a[2]||(a[2]=o=>p(u).ruleFinder.engine=o),size:"small",variant:"default-filled"},{default:l(()=>[e(L,{value:"xpath"},{default:l(()=>[_("XPATH")]),_:1}),e(L,{value:"jsonpath"},{default:l(()=>[_("JSONPATH")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:"书籍列表",name:"ruleFinder.bookList"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.bookList,"onUpdate:modelValue":a[3]||(a[3]=o=>p(u).ruleFinder.bookList=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:"书籍名称",name:"ruleFinder.bookName"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.bookName,"onUpdate:modelValue":a[4]||(a[4]=o=>p(u).ruleFinder.bookName=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:"书籍地址",name:"ruleFinder.bookUrl"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.bookUrl,"onUpdate:modelValue":a[5]||(a[5]=o=>p(u).ruleFinder.bookUrl=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:"书籍作者",name:"ruleFinder.bookAuthor"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.bookAuthor,"onUpdate:modelValue":a[6]||(a[6]=o=>p(u).ruleFinder.bookAuthor=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{align:"right"},{default:l(()=>[_(te(m.$t("pages.source.common.extendedRule")),1)]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookDescription"),name:"ruleFinder.ruleExtra.introduce"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.introduce,"onUpdate:modelValue":a[7]||(a[7]=o=>p(u).ruleFinder.ruleExtra.introduce=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookCover"),name:"ruleFinder.ruleExtra.coverUrl"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.coverUrl,"onUpdate:modelValue":a[8]||(a[8]=o=>p(u).ruleFinder.ruleExtra.coverUrl=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookCategory"),name:"ruleFinder.ruleExtra.classify"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.classify,"onUpdate:modelValue":a[9]||(a[9]=o=>p(u).ruleFinder.ruleExtra.classify=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookSize"),name:"ruleFinder.ruleExtra.bookSize"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.bookSize,"onUpdate:modelValue":a[10]||(a[10]=o=>p(u).ruleFinder.ruleExtra.bookSize=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookLatestChapterName"),name:"ruleFinder.ruleExtra.lastChapterName"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.lastChapterName,"onUpdate:modelValue":a[11]||(a[11]=o=>p(u).ruleFinder.ruleExtra.lastChapterName=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookLatestUpdateTime"),name:"ruleFinder.ruleExtra.lastUpdateTime"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.lastUpdateTime,"onUpdate:modelValue":a[12]||(a[12]=o=>p(u).ruleFinder.ruleExtra.lastUpdateTime=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(y,{class:"row-gap"},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(f,{label:m.$t("pages.source.common.bookCompletionStatus"),name:"ruleFinder.ruleExtra.status"},{default:l(()=>[e(s,{modelValue:p(u).ruleFinder.ruleExtra.status,"onUpdate:modelValue":a[13]||(a[13]=o=>p(u).ruleFinder.ruleExtra.status=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(Ne,{visible:h.value,"onUpdate:visible":a[14]||(a[14]=o=>h.value=o),value:J.value,onConfirm:W},null,8,["visible","value"])])}}}),Re=ne(De,[["__scopeId","data-v-f1ebe9c5"]]);export{Re as default};
