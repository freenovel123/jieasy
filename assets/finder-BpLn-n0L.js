import{f as oe,V as ue,g as E,m as D,A as te,l as re,r as c,o as S,c as $,a as e,w as t,b as h,d as v,M as T,N as J,W as ne,X as se,E as G,H as w,D as fe,Y as _e,Z as le,$ as ge,J as be,_ as de,a0 as ye,R as p,t as ae,a1 as Fe}from"./index--TtAS5k8.js";import{S as Se}from"./index-Hi3OqBGe.js";import{S as k}from"./index-DlpzpFYv.js";const Ve={class:"steve-category-tools"},Ue={class:"structure"},ke={class:"structure-body"},Ee={class:"structure-body__url"},xe={class:"structure-body__url__type"},we={key:1,class:"structure-body__param"},Te={key:2,class:"structure-body__param"},Ce={key:3,class:"structure-body__group"},he={class:"group-body__name"},$e={class:"group-body__ace"},Ne={class:"group-body__option"},ze=oe({__name:"index",props:{visible:{type:Boolean,default:!1},value:Object},emits:["update:visible","confirm"],setup(q,{emit:I}){const u=q,{visible:N,value:L}=ue(u),O=I,x=E(!1);D(N,r=>{x.value=r}),D(x,r=>{O("update:visible",r)});const n=E(te({uuid:"",name:"",method:"GET",params:"",requestEncode:"utf-8",responseEncode:"utf-8",structure:"",list:[]}));D(L,r=>{r?(n.value=r,m.value=r.list):(n.value.uuid="",n.value.name="",n.value.structure="",n.value.list=[],m.value=[])});const i=E([]);D(n,r=>{const{structure:l}=r;if(l){i.value=[];const s=/@{_(.*?)}/g;for(const U of l.matchAll(s)){const[,g]=U;g&&!i.value.includes(g)&&i.value.push(g)}const f=[];for(const U of i.value){const g=M(U);g?f.push(g):f.push({name:U,type:U,list:""})}m.value=f}},{deep:!0});const a=E(1);D(a,()=>{z()});const _=E(""),V=E(0),b=E(0),j=re(()=>b.value>0&&V.value!==b.value),C=E(0),m=E([]),y=()=>{const r=m.value[C.value];if(r){const l=_e(r.list);if(l&&l.length>0){for(const s of l){let f=n.value.structure;!w.isURL(s.path)&&w.isURL(f)&&(f=le(f)),w.isURL(s.path)&&!w.isURL(f)&&(s.path=le(s.path));const g=ge(f).exec(s.path);s.value=g?g[C.value+1]:"",delete s.path}m.value[C.value].list=be(JSON.stringify(l))}else G("请输入有效的HTML内容！","warning")}},F=r=>{const{selectedText:l,selectionStart:s,selectionEnd:f}=Z(r.target);_.value=l,V.value=s,b.value=f},R=()=>{_.value&&(n.value.structure=`${n.value.structure.slice(0,V.value)}@{_${_.value}}${n.value.structure.slice(b.value)}`,G(`构造${_.value}成功！`),z())},H=r=>{n.value.structure=`${n.value.structure.slice(0,V.value)}@{params.${r}}${n.value.structure.slice(b.value)}`,z()},z=()=>{_.value="",V.value=0,b.value=0},o=()=>{const r=n.value;if(!r.name){G("请输入榜单名称","warning");return}if(!r.structure){G("请输入构造地址","warning");return}r.uuid||(r.uuid=`${new Date().getTime()}`);const l=te(m.value);if(l&&l.length>0){for(const s of l)s&&w.isJSON(s.list)&&(s.list=fe(s.list));r.list=l}O("confirm",r)};function M(r){let l;for(const s of m.value)s.type===r&&(l=s);return l}function Z(r){let l="";const{selectionStart:s,selectionEnd:f}=r;return s!==f?l=r.value.substring(s,f):l="",{selectedText:l,selectionStart:s,selectionEnd:f}}return(r,l)=>{const s=c("t-input"),f=c("t-form-item"),U=c("t-col"),g=c("t-radio-button"),A=c("t-radio-group"),K=c("t-row"),Q=c("t-textarea"),ie=c("t-divider"),X=c("t-tag"),P=c("t-button"),B=c("t-space"),pe=c("t-tab-panel"),ce=c("t-tabs"),me=c("t-form"),ve=c("t-drawer");return S(),$("div",Ve,[e(ve,{visible:x.value,"onUpdate:visible":l[10]||(l[10]=d=>x.value=d),header:"榜单设置",size:"50%","close-on-overlay-click":!1,"destroy-on-close":!0,onCancel:l[11]||(l[11]=d=>x.value=!1),onConfirm:o},{default:t(()=>[h("div",Ue,[h("div",ke,[e(me,null,{default:t(()=>[e(B,{size:10,direction:"vertical"},{default:t(()=>[e(K,{class:"row-gap"},{default:t(()=>[e(U,{span:6},{default:t(()=>[e(f,{label:"榜单名称",name:"formData.name"},{default:t(()=>[e(s,{modelValue:n.value.name,"onUpdate:modelValue":l[0]||(l[0]=d=>n.value.name=d),placeholder:"榜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:6},{default:t(()=>[e(f,{label:"请求方式",name:"formData.method"},{default:t(()=>[e(A,{modelValue:n.value.method,"onUpdate:modelValue":l[1]||(l[1]=d=>n.value.method=d),size:"small",variant:"default-filled"},{default:t(()=>[e(g,{value:"GET"},{default:t(()=>[v("GET")]),_:1}),e(g,{value:"POST"},{default:t(()=>[v("POST")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(K,{class:"row-gap"},{default:t(()=>[e(U,{span:6},{default:t(()=>[e(f,{label:r.$t("pages.source.common.requestEncode"),name:"ruleSearch.requestEncode"},{default:t(()=>[e(A,{modelValue:n.value.requestEncode,"onUpdate:modelValue":l[2]||(l[2]=d=>n.value.requestEncode=d),size:"small",variant:"default-filled"},{default:t(()=>[e(g,{value:"utf-8"},{default:t(()=>[v("UTF-8")]),_:1}),e(g,{value:"gbk"},{default:t(()=>[v("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(U,{span:6},{default:t(()=>[e(f,{label:r.$t("pages.source.common.responseEncode"),name:"ruleSearch.responseEncode"},{default:t(()=>[e(A,{modelValue:n.value.responseEncode,"onUpdate:modelValue":l[3]||(l[3]=d=>n.value.responseEncode=d),size:"small",variant:"default-filled"},{default:t(()=>[e(g,{value:"utf-8"},{default:t(()=>[v("UTF-8")]),_:1}),e(g,{value:"gbk"},{default:t(()=>[v("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),n.value.method==="POST"?(S(),T(K,{key:0,class:"row-gap"},{default:t(()=>[e(U,{span:12},{default:t(()=>[e(f,{label:"请求参数",name:"formData.params"},{default:t(()=>[e(Q,{modelValue:n.value.params,"onUpdate:modelValue":l[4]||(l[4]=d=>n.value.params=d),placeholder:"请求参数应该为一个json类型的字符串"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):J("",!0),e(ie,{align:"left"},{default:t(()=>[v("构造地址")]),_:1}),h("div",Ee,[h("div",xe,[e(A,{modelValue:a.value,"onUpdate:modelValue":l[5]||(l[5]=d=>a.value=d),size:"small",variant:"default-filled"},{default:t(()=>[e(g,{value:1},{default:t(()=>[v("构造分组")]),_:1}),e(g,{value:2},{default:t(()=>[v("快捷操作")]),_:1})]),_:1},8,["modelValue"])]),e(Q,{modelValue:n.value.structure,"onUpdate:modelValue":l[6]||(l[6]=d=>n.value.structure=d),placeholder:"请输入榜单页面完整的URL地址或路径(即不包含host的path)，使用鼠标选中或直接根据规则修改即可构造相应的分组以及参数",autosize:{minRows:3,maxRows:5},onMouseup:F},null,8,["modelValue"])]),a.value==1?(S(),$("div",we,[j.value?(S(),T(B,{key:0,align:"center",size:"2px"},{default:t(()=>[e(X,{theme:"primary",variant:"light"},{default:t(()=>[v("@{_")]),_:1}),e(s,{modelValue:_.value,"onUpdate:modelValue":l[7]||(l[7]=d=>_.value=d),placeholder:"请输入自定义参数名称",class:"structure-body__param__input",size:"small"},null,8,["modelValue"]),e(X,{theme:"primary",variant:"light"},{default:t(()=>[v("}")]),_:1}),e(P,{class:"button",size:"small",onClick:R},{default:t(()=>[v("确认")]),_:1}),e(P,{class:"button",theme:"default",size:"small",onClick:z},{default:t(()=>[v("取消")]),_:1})]),_:1})):(S(),T(X,{key:1,variant:"light",theme:"primary"},{default:t(()=>[v("请先选中需要构造的内容")]),_:1}))])):J("",!0),a.value==2?(S(),$("div",Te,[e(B,{size:"10px"},{default:t(()=>[e(P,{size:"small",onClick:l[8]||(l[8]=d=>H("pageIndex"))},{default:t(()=>[v("添加页码")]),_:1})]),_:1})])):J("",!0),m.value.length>0?(S(),$("div",Ce,[e(ce,{modelValue:C.value,"onUpdate:modelValue":l[9]||(l[9]=d=>C.value=d),theme:"card"},{default:t(()=>[(S(!0),$(ne,null,se(m.value,(d,ee)=>(S(),T(pe,{key:ee,value:ee,label:d.name,"destroy-on-hide":!1},{default:t(()=>[e(B,{class:"group-body",direction:"vertical",size:10},{default:t(()=>[h("div",he,[e(s,{modelValue:d.name,"onUpdate:modelValue":W=>d.name=W,placeholder:"分组名称，比如，分类、排序、状态等"},null,8,["modelValue","onUpdate:modelValue"])]),h("div",$e,[e(Se,{value:d.list,"onUpdate:value":W=>d.list=W,height:300},null,8,["value","onUpdate:value"])]),h("div",Ne,[e(P,{onClick:y},{default:t(()=>[v("转换")]),_:1})])]),_:2},1024)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])):J("",!0)]),_:1})]),_:1})])])]),_:1},8,["visible"])])}}}),Oe=de(ze,[["__scopeId","data-v-8f9e2d4c"]]),De={class:"finder"},Je=oe({__name:"finder",props:{formData:Object},setup(q){const I=q,{formData:u}=ue(I),N=E(!1),L=E({}),O=i=>{L.value=i,N.value=!0},x=re(()=>{const{category:i}=u.value.ruleFinder;return w.isJSON(i)?JSON.parse(i):[]}),Y=i=>{const{category:a}=u.value.ruleFinder;let _=[];a&&w.isJSON(a)&&(_=JSON.parse(a));let V=!1;for(let b=0;b<_.length;b++)_[b].uuid===i.uuid&&(_[b]=i,V=!0);V||_.push(i),u.value.ruleFinder.category=JSON.stringify(_),N.value=!1},n=i=>{if(i.type==="delete"){const{category:a}=u.value.ruleFinder,_=[];if(a&&w.isJSON(a)){const V=JSON.parse(a);for(const b of V)b.uuid!==i.value&&_.push(b);u.value.ruleFinder.category=JSON.stringify(_)}}};return(i,a)=>{const _=c("t-textarea"),V=c("t-button"),b=c("t-dropdown"),j=c("t-space"),C=c("t-tag"),m=c("t-form-item"),y=c("t-col"),F=c("t-row"),R=c("t-radio-button"),H=c("t-radio-group"),z=c("t-divider");return S(),$("div",De,[e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:"榜单",name:"ruleFinder.category"},{tips:t(()=>[e(V,{size:"small",class:"finder-tools",onClick:a[1]||(a[1]=o=>O(null))},{default:t(()=>[v("添加榜单")]),_:1})]),default:t(()=>[ye(e(_,{modelValue:p(u).ruleFinder.category,"onUpdate:modelValue":a[0]||(a[0]=o=>p(u).ruleFinder.category=o)},null,8,["modelValue"]),[[Fe,!1]]),x.value.length>0?(S(),T(j,{key:0,size:10},{default:t(()=>[(S(!0),$(ne,null,se(x.value,(o,M)=>(S(),T(b,{key:M,options:[{content:"删除",type:"delete",value:o.uuid}],onClick:n},{default:t(()=>[o&&o.name?(S(),T(V,{key:0,variant:"outline",theme:"primary",onClick:Z=>O(o)},{default:t(()=>[v(ae(o.name),1)]),_:2},1032,["onClick"])):J("",!0)]),_:2},1032,["options"]))),128))]),_:1})):(S(),T(C,{key:1,theme:"primary",variant:"light-outline"},{default:t(()=>[v("暂时还没有榜单，添加一个吧！")]),_:1}))]),_:1})]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.engine"),name:"ruleFinder.engine"},{default:t(()=>[e(H,{modelValue:p(u).ruleFinder.engine,"onUpdate:modelValue":a[2]||(a[2]=o=>p(u).ruleFinder.engine=o),size:"small",variant:"default-filled"},{default:t(()=>[e(R,{value:"xpath"},{default:t(()=>[v("XPATH")]),_:1}),e(R,{value:"jsonpath"},{default:t(()=>[v("JSONPATH")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:"书籍列表",name:"ruleFinder.bookList"},{default:t(()=>[e(k,{value:p(u).ruleFinder.bookList,"onUpdate:value":a[3]||(a[3]=o=>p(u).ruleFinder.bookList=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:"书籍名称",name:"ruleFinder.bookName"},{default:t(()=>[e(k,{value:p(u).ruleFinder.bookName,"onUpdate:value":a[4]||(a[4]=o=>p(u).ruleFinder.bookName=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:"书籍地址",name:"ruleFinder.bookUrl"},{default:t(()=>[e(k,{value:p(u).ruleFinder.bookUrl,"onUpdate:value":a[5]||(a[5]=o=>p(u).ruleFinder.bookUrl=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:"书籍作者",name:"ruleFinder.bookAuthor"},{default:t(()=>[e(k,{value:p(u).ruleFinder.bookAuthor,"onUpdate:value":a[6]||(a[6]=o=>p(u).ruleFinder.bookAuthor=o)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(z,{align:"right"},{default:t(()=>[v(ae(i.$t("pages.source.common.extendedRule")),1)]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookDescription"),name:"ruleFinder.ruleExtra.introduce"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.introduce,"onUpdate:value":a[7]||(a[7]=o=>p(u).ruleFinder.ruleExtra.introduce=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookCover"),name:"ruleFinder.ruleExtra.coverUrl"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.coverUrl,"onUpdate:value":a[8]||(a[8]=o=>p(u).ruleFinder.ruleExtra.coverUrl=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookCategory"),name:"ruleFinder.ruleExtra.classify"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.classify,"onUpdate:value":a[9]||(a[9]=o=>p(u).ruleFinder.ruleExtra.classify=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookSize"),name:"ruleFinder.ruleExtra.bookSize"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.bookSize,"onUpdate:value":a[10]||(a[10]=o=>p(u).ruleFinder.ruleExtra.bookSize=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookLatestChapterName"),name:"ruleFinder.ruleExtra.lastChapterName"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.lastChapterName,"onUpdate:value":a[11]||(a[11]=o=>p(u).ruleFinder.ruleExtra.lastChapterName=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookLatestUpdateTime"),name:"ruleFinder.ruleExtra.lastUpdateTime"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.lastUpdateTime,"onUpdate:value":a[12]||(a[12]=o=>p(u).ruleFinder.ruleExtra.lastUpdateTime=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{class:"row-gap"},{default:t(()=>[e(y,{span:12},{default:t(()=>[e(m,{label:i.$t("pages.source.common.bookCompletionStatus"),name:"ruleFinder.ruleExtra.status"},{default:t(()=>[e(k,{value:p(u).ruleFinder.ruleExtra.status,"onUpdate:value":a[13]||(a[13]=o=>p(u).ruleFinder.ruleExtra.status=o)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(Oe,{visible:N.value,"onUpdate:visible":a[14]||(a[14]=o=>N.value=o),value:L.value,onConfirm:Y},null,8,["visible","value"])])}}}),Pe=de(Je,[["__scopeId","data-v-a3d5bd8c"]]);export{Pe as default};
