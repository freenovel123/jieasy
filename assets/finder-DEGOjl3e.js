import{f as Q,g as U,V as ee,m as R,l as le,r as i,o as y,c as S,a as e,w as l,b as z,d as c,M as C,N as h,W as K,X as te,E as J,A as me,H as T,D as pe,Y as ce,Z as Y,$ as fe,J as _e,_ as ae,a0 as ve,R as n,t as Z,a1 as ge}from"./index-DmkDoW0u.js";import be from"./AceEditor-C71ZMvVl.js";const Ve={class:"steve-category-tools"},ye={class:"structure"},Fe={class:"structure-body"},Ue={class:"structure-body__url"},ke={class:"structure-body__url__type"},Ee={key:1,class:"structure-body__param"},Se={key:2,class:"structure-body__param"},xe={key:3,class:"structure-body__group"},we={class:"group-body__name"},ze={class:"group-body__ace"},Te={class:"group-body__option"},Ce=Q({__name:"index",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","confirm"],setup(A,{emit:P}){const u=A,x=P,w=U(!1),{visible:$}=ee(u);R($,d=>{w.value=d}),R(w,d=>{x("update:visible",d)});const m=U({name:"",method:"GET",params:"",requestEncode:"utf-8",responseEncode:"utf-8",structure:"",list:[]}),v=U([]);R(m,d=>{const{structure:t}=d;if(t){v.value=[];const s=/@{_(.*?)}/g;for(const F of t.matchAll(s)){const[,b]=F;b&&!v.value.includes(b)&&v.value.push(b)}const _=[];for(const F of v.value){const b=oe(F);b?_.push(b):_.push({name:F,type:F,list:""})}f.value=_}},{deep:!0});const a=U(1);R(a,()=>{o()});const p=U(""),k=U(0),E=U(0),B=le(()=>E.value>0&&k.value!==E.value),g=U(0),f=U([]),V=()=>{const d=f.value[g.value];if(d){const t=ce(d.list);if(t&&t.length>0){for(const s of t){let _=m.value.structure;!T.isURL(s.path)&&T.isURL(_)&&(_=Y(_)),T.isURL(s.path)&&!T.isURL(_)&&(s.path=Y(s.path));const b=fe(_).exec(s.path);s.value=b?b[g.value+1]:""}f.value[g.value].list=_e(JSON.stringify(t))}else J("请输入有效的HTML内容！","warning")}},N=d=>{const{selectedText:t,selectionStart:s,selectionEnd:_}=ue(d.target);p.value=t,k.value=s,E.value=_},G=()=>{p.value&&(m.value.structure=`${m.value.structure.slice(0,k.value)}@{_${p.value}}${m.value.structure.slice(E.value)}`,J(`构造${p.value}成功！`),o())},q=d=>{m.value.structure=`${m.value.structure.slice(0,k.value)}@{params.${d}}${m.value.structure.slice(E.value)}`,o()},o=()=>{p.value="",k.value=0,E.value=0},H=()=>{const d=m.value;if(!d.name){J("请输入榜单名称","warning");return}if(!d.structure){J("请输入构造地址","warning");return}const t=me(f.value);if(t&&t.length>0){for(const s of t)s&&T.isJSON(s.list)&&(s.list=pe(s.list));d.list=t}x("confirm",d)};function oe(d){let t;for(const s of f.value)s.type===d&&(t=s);return t}function ue(d){let t="";const{selectionStart:s,selectionEnd:_}=d;return s!==_?t=d.value.substring(s,_):t="",{selectedText:t,selectionStart:s,selectionEnd:_}}return(d,t)=>{const s=i("t-input"),_=i("t-form-item"),F=i("t-col"),b=i("t-radio-button"),O=i("t-radio-group"),M=i("t-row"),X=i("t-textarea"),re=i("t-divider"),I=i("t-tag"),L=i("t-button"),D=i("t-space"),se=i("t-tab-panel"),ne=i("t-tabs"),de=i("t-form"),ie=i("t-drawer");return y(),S("div",Ve,[e(ie,{visible:w.value,"onUpdate:visible":t[10]||(t[10]=r=>w.value=r),header:"榜单设置",size:"50%","close-on-overlay-click":!1,onCancel:t[11]||(t[11]=r=>w.value=!1),onConfirm:H},{default:l(()=>[z("div",ye,[z("div",Fe,[e(de,null,{default:l(()=>[e(D,{size:10,direction:"vertical"},{default:l(()=>[e(M,{class:"row-gap"},{default:l(()=>[e(F,{span:6},{default:l(()=>[e(_,{label:"榜单名称",name:"formData.name"},{default:l(()=>[e(s,{modelValue:m.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>m.value.name=r),placeholder:"榜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:l(()=>[e(_,{label:"请求方式",name:"formData.method"},{default:l(()=>[e(O,{modelValue:m.value.method,"onUpdate:modelValue":t[1]||(t[1]=r=>m.value.method=r),size:"small",variant:"default-filled"},{default:l(()=>[e(b,{value:"GET"},{default:l(()=>[c("GET")]),_:1}),e(b,{value:"POST"},{default:l(()=>[c("POST")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{class:"row-gap"},{default:l(()=>[e(F,{span:6},{default:l(()=>[e(_,{label:d.$t("pages.source.common.requestEncode"),name:"ruleSearch.requestEncode"},{default:l(()=>[e(O,{modelValue:m.value.requestEncode,"onUpdate:modelValue":t[2]||(t[2]=r=>m.value.requestEncode=r),size:"small",variant:"default-filled"},{default:l(()=>[e(b,{value:"utf-8"},{default:l(()=>[c("UTF-8")]),_:1}),e(b,{value:"gbk"},{default:l(()=>[c("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(F,{span:6},{default:l(()=>[e(_,{label:d.$t("pages.source.common.responseEncode"),name:"ruleSearch.responseEncode"},{default:l(()=>[e(O,{modelValue:m.value.responseEncode,"onUpdate:modelValue":t[3]||(t[3]=r=>m.value.responseEncode=r),size:"small",variant:"default-filled"},{default:l(()=>[e(b,{value:"utf-8"},{default:l(()=>[c("UTF-8")]),_:1}),e(b,{value:"gbk"},{default:l(()=>[c("GBK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),m.value.method==="POST"?(y(),C(M,{key:0,class:"row-gap"},{default:l(()=>[e(F,{span:12},{default:l(()=>[e(_,{label:"请求参数",name:"formData.params"},{default:l(()=>[e(X,{modelValue:m.value.params,"onUpdate:modelValue":t[4]||(t[4]=r=>m.value.params=r),placeholder:"请求参数应该为一个json类型的字符串"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):h("",!0),e(re,{align:"left"},{default:l(()=>[c("构造地址")]),_:1}),z("div",Ue,[z("div",ke,[e(O,{modelValue:a.value,"onUpdate:modelValue":t[5]||(t[5]=r=>a.value=r),size:"small",variant:"default-filled"},{default:l(()=>[e(b,{value:1},{default:l(()=>[c("构造分组")]),_:1}),e(b,{value:2},{default:l(()=>[c("快捷操作")]),_:1})]),_:1},8,["modelValue"])]),e(X,{modelValue:m.value.structure,"onUpdate:modelValue":t[6]||(t[6]=r=>m.value.structure=r),placeholder:"请输入榜单页面完整的URL地址或路径(即不包含host的path)，使用鼠标选中或直接根据规则修改即可构造相应的分组以及参数",autosize:{minRows:3,maxRows:5},onMouseup:N},null,8,["modelValue"])]),a.value==1?(y(),S("div",Ee,[B.value?(y(),C(D,{key:0,align:"center",size:"2px"},{default:l(()=>[e(I,{theme:"primary",variant:"light"},{default:l(()=>[c("@{_")]),_:1}),e(s,{modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=r=>p.value=r),placeholder:"请输入自定义参数名称",class:"structure-body__param__input",size:"small"},null,8,["modelValue"]),e(I,{theme:"primary",variant:"light"},{default:l(()=>[c("}")]),_:1}),e(L,{class:"button",onClick:G,size:"small"},{default:l(()=>[c("确认")]),_:1}),e(L,{class:"button",theme:"default",onClick:o,size:"small"},{default:l(()=>[c("取消")]),_:1})]),_:1})):(y(),C(I,{key:1,variant:"light",theme:"primary"},{default:l(()=>[c("请先选中需要构造的内容")]),_:1}))])):h("",!0),a.value==2?(y(),S("div",Se,[e(D,{size:"10px"},{default:l(()=>[e(L,{size:"small",onClick:t[8]||(t[8]=r=>q("pageIndex"))},{default:l(()=>[c("添加页码")]),_:1})]),_:1})])):h("",!0),f.value.length>0?(y(),S("div",xe,[e(ne,{modelValue:g.value,"onUpdate:modelValue":t[9]||(t[9]=r=>g.value=r),theme:"card"},{default:l(()=>[(y(!0),S(K,null,te(f.value,(r,W)=>(y(),C(se,{key:W,value:W,label:r.name,"destroy-on-hide":!1},{default:l(()=>[e(D,{class:"group-body",direction:"vertical",size:10},{default:l(()=>[z("div",we,[e(s,{modelValue:r.name,"onUpdate:modelValue":j=>r.name=j,placeholder:"分组名称，比如，分类、排序、状态等"},null,8,["modelValue","onUpdate:modelValue"])]),z("div",ze,[e(be,{value:r.list,"onUpdate:value":j=>r.list=j,height:300,placeholder:"请输入需要转换的HTML代码"},null,8,["value","onUpdate:value"])]),z("div",Te,[e(L,{onClick:V},{default:l(()=>[c("转换")]),_:1})])]),_:2},1024)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])):h("",!0)]),_:1})]),_:1})])])]),_:1},8,["visible"])])}}}),he=ae(Ce,[["__scopeId","data-v-be2a427a"]]),$e={class:"finder"},Ne=Q({__name:"finder",props:{formData:Object},setup(A){const P=A,{formData:u}=ee(P),x=U(!1),w=()=>{x.value=!0},$=le(()=>{const{category:v}=u.value.ruleFinder;return T.isJSON(v)?JSON.parse(v):[]}),m=v=>{const{category:a}=u.value.ruleFinder;let p=[];a&&T.isJSON(a)&&(p=JSON.parse(a)),p.push(v),u.value.ruleFinder.category=JSON.stringify(p),x.value=!1};return(v,a)=>{const p=i("t-textarea"),k=i("t-button"),E=i("t-space"),B=i("t-tag"),g=i("t-form-item"),f=i("t-col"),V=i("t-row"),N=i("t-radio-button"),G=i("t-radio-group"),q=i("t-divider");return y(),S("div",$e,[e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:"榜单",name:"ruleFinder.category"},{tips:l(()=>[e(k,{size:"small",class:"finder-tools",onClick:w},{default:l(()=>[c("添加榜单")]),_:1})]),default:l(()=>[ve(e(p,{modelValue:n(u).ruleFinder.category,"onUpdate:modelValue":a[0]||(a[0]=o=>n(u).ruleFinder.category=o)},null,8,["modelValue"]),[[ge,!1]]),$.value.length>0?(y(),C(E,{key:0,size:10},{default:l(()=>[(y(!0),S(K,null,te($.value,(o,H)=>(y(),S(K,{key:H},[o&&o.name?(y(),C(k,{key:0,variant:"outline",theme:"primary",size:"small"},{default:l(()=>[c(Z(o.name),1)]),_:2},1024)):h("",!0)],64))),128))]),_:1})):(y(),C(B,{key:1,theme:"primary",variant:"light-outline"},{default:l(()=>[c("暂时还没有榜单，添加一个吧！")]),_:1}))]),_:1})]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.engine"),name:"ruleFinder.engine"},{default:l(()=>[e(G,{modelValue:n(u).ruleFinder.engine,"onUpdate:modelValue":a[1]||(a[1]=o=>n(u).ruleFinder.engine=o),size:"small",variant:"default-filled"},{default:l(()=>[e(N,{value:"xpath"},{default:l(()=>[c("XPATH")]),_:1}),e(N,{value:"jsonpath"},{default:l(()=>[c("JSONPATH")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:"书籍列表",name:"ruleFinder.bookList"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.bookList,"onUpdate:modelValue":a[2]||(a[2]=o=>n(u).ruleFinder.bookList=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:"书籍名称",name:"ruleFinder.bookName"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.bookName,"onUpdate:modelValue":a[3]||(a[3]=o=>n(u).ruleFinder.bookName=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:"书籍地址",name:"ruleFinder.bookUrl"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.bookUrl,"onUpdate:modelValue":a[4]||(a[4]=o=>n(u).ruleFinder.bookUrl=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:"书籍作者",name:"ruleFinder.bookAuthor"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.bookAuthor,"onUpdate:modelValue":a[5]||(a[5]=o=>n(u).ruleFinder.bookAuthor=o),autosize:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{align:"right"},{default:l(()=>[c(Z(v.$t("pages.source.common.extendedRule")),1)]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookDescription"),name:"ruleFinder.ruleExtra.introduce"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.introduce,"onUpdate:modelValue":a[6]||(a[6]=o=>n(u).ruleFinder.ruleExtra.introduce=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookCover"),name:"ruleFinder.ruleExtra.coverUrl"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.coverUrl,"onUpdate:modelValue":a[7]||(a[7]=o=>n(u).ruleFinder.ruleExtra.coverUrl=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookCategory"),name:"ruleFinder.ruleExtra.classify"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.classify,"onUpdate:modelValue":a[8]||(a[8]=o=>n(u).ruleFinder.ruleExtra.classify=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookSize"),name:"ruleFinder.ruleExtra.bookSize"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.bookSize,"onUpdate:modelValue":a[9]||(a[9]=o=>n(u).ruleFinder.ruleExtra.bookSize=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookLatestChapterName"),name:"ruleFinder.ruleExtra.lastChapterName"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.lastChapterName,"onUpdate:modelValue":a[10]||(a[10]=o=>n(u).ruleFinder.ruleExtra.lastChapterName=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookLatestUpdateTime"),name:"ruleFinder.ruleExtra.lastUpdateTime"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.lastUpdateTime,"onUpdate:modelValue":a[11]||(a[11]=o=>n(u).ruleFinder.ruleExtra.lastUpdateTime=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(V,{class:"row-gap"},{default:l(()=>[e(f,{span:12},{default:l(()=>[e(g,{label:v.$t("pages.source.common.bookCompletionStatus"),name:"ruleFinder.ruleExtra.status"},{default:l(()=>[e(p,{modelValue:n(u).ruleFinder.ruleExtra.status,"onUpdate:modelValue":a[12]||(a[12]=o=>n(u).ruleFinder.ruleExtra.status=o),autosize:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(he,{visible:x.value,"onUpdate:visible":a[13]||(a[13]=o=>x.value=o),onConfirm:m},null,8,["visible"])])}}}),De=ae(Ne,[["__scopeId","data-v-f3ac95fd"]]);export{De as default};
